#!/bin/sh

# A modular status bar for dwm Joe Standring 
# <git@joestandring.com> GNU GPLv3

# Dependencies: xorg-xsetroot

# Import functions with "$include /route/to/module" It is 
# recommended that you place functions in the subdirectory 
# ./bar-functions and use: . 
# "$DIR/bar-functions/dwm_example.sh"

# Store the directory the script is running from
LOC=$(readlink -f "$0") DIR=$(dirname "$LOC")

# Change the appearance of the module identifier. if this 
# is set to "unicode", then symbols will be used as 
# identifiers instead of text. E.g. [ðŸ“ª 0] instead of 
# [MAIL 0]. Requires a font with adequate unicode character 
# support
export IDENTIFIER="unicode"
export BAR_FUNC_PATH=$DIR/bar-functions

# Change the charachter(s) used to seperate modules. If two 
# are used, they will be placed at the start and end.
# export SEP1="|" 
# export SEP2="]"
# mkdir /dev/shm/bar
# Import the modules . 
#. "$DIR/bar-functions/dwm_countdown.sh" . 
#. "$DIR/bar-functions/dwm_transmission.sh"
#. "$DIR/bar-functions/dwm_cmus.sh" 
#. "$DIR/bar-functions/dwm_resources.sh" 
#. "$DIR/bar-functions/dwm_battery.sh" 
#. "$DIR/bar-functions/dwm_mail.sh"
#. "$DIR/bar-functions/dwm_backlight.sh" 
#. "$DIR/bar-functions/dwm_alsa.sh"
#. "$DIR/bar-functions/dwm_pulse.sh" 
#. "$DIR/bar-functions/dwm_weather.sh"
#. "$DIR/bar-functions/dwm_vpn.sh"
#. "$DIR/bar-functions/dwm_network.sh" 
#. "$DIR/bar-functions/dwm_keyboard.sh" 
#. "$DIR/bar-functions/dwm_ccurse.sh"
#. "$DIR/bar-functions/dwm_date.sh"
#. "$DIR/bar-functions/dwm_update.sh"

# Update modules that will be executed one time only
# $DIR/bar-functions/dwm_backlight.sh
# $DIR/bar-functions/dwm_alsa.sh

# Update dwm status bar
update(){
	bar=""
	for fich in /dev/shm/bar/*
	do
		bar="$bar $(cat $fich)"
	done
	sudo -u jm DISPLAY=:0 DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus xsetroot -name "$bar"
	wait
}

# Handle SIGTRAP signals sent by refbar to update the status bar immediately
update
trap "update" 5
